Bootstrap: docker
From: python:3.10

### SPINNAKER DEVELOPMENT ENVIRONMENT ###
# Following DevEnv setup found here
# http://spinnakermanchester.github.io/development/devenv6.0.html

### NESTML DEVELOPMENT SETUP ###
# Cloning from repository and using setup script


# Run after loading OS but in host system, ${APPTAINER_ROOTFS} to reference container
%setup
    mkdir ${APPTAINER_ROOTFS}/home/nestml

    cp ./.spynnaker.cfg ~/


# Save way to copy files: source destination(in container)
%files

# Setting environment variables
%environment


# Downloading, installing libraries, define environment variables used in build process
%post
    apt-get update -y
    apt-get upgrade -y

    # [SPINNAKER] Install
    pip install matplotlib
    pip install sPyNNaker
    python -m spynnaker8.setup_pynn

    # [NESTML] Source repository
    git clone https://github.com/siirty/nestml.git ${APPTAINER_ROOTFS}/home/nestml
    # Not installing nestml here because would be for root user

    # [NESTML] Python testing
    pip install pytest



# Written to file in container which is run when 'apptainer run' is called . 
# Appended parameters to run command are accessible here
%runscript

# Written to file in container which is run when 'instance start' is called . 
# Appended parameters to run command are accessible here
%startscript


# Runs at end of build process to validate container
%test
    # cd /home/spinnaker/ && python /home/spinnaker/source/PyNN8Examples/examples/va_benchmark.py
    # pytest /home/nestml/nestml/tests/spinnaker_tests/test_spinnaker_iaf_psc_exp.py 


# Metadata of container like author
%labels


# Output of the 'run-help' command
%help